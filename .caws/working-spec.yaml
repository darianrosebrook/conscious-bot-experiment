id: MCB-482
title: "LLM-driven observation reasoning for Minecraft interface"
risk_tier: 2
scope:
  in:
    - "Replace hardcoded entity/environment thoughts in bot adapter with LLM-generated insights"
    - "Augment cognition service environmental_awareness pipeline to consume structured observations and return action guidance"
    - "Wire planning task suggestions to use LLM-provided structured actions when available"
  out:
    - "Overhauling chat conversation flow or external social reasoning modules"
    - "Introducing new Minecraft behaviours beyond observation-driven reactions"
    - "Persisting long-term memory summaries of every observation"
invariants:
  - "Observation payloads sent from minecraft-interface must include entity/event metadata and current bot vitals"
  - "LLM outputs are validated as JSON with thought + action fields; invalid responses trigger deterministic fallback"
  - "Generated planning tasks must reference the originating observation id for auditability"
acceptance:
  - id: A1
    given: "A nearby entity is detected within observation radius"
    when: "bot-adapter processes the entity"
    then: "it calls cognition environmental_awareness endpoint with structured payload and receives an LLM-authored thought"
  - id: A2
    given: "Cognition returns action suggestions for an observation"
    when: "bot-adapter handles the insight"
    then: "it respects chat/task throttles and forwards structured tasks to the planning service with observation metadata"
  - id: A3
    given: "LLM generation times out or produces invalid output"
    when: "cognition processes the observation"
    then: "a safe fallback thought is emitted, no unsafe actions are queued, and the failure is logged with metrics"
non_functional:
  a11y:
    - "Server-side change; ensure dashboard cognitive stream renders new thought metadata without regression"
  perf:
    api_p95_ms: 400
    lcp_ms: 2500
  security:
    - "Scrub sensitive coordinates before logging; no raw auth tokens in prompts"
contracts:
  - type: openapi
    path: "contracts/cognition-observation.yaml#/components/schemas/ObservationInsight"
  - type: openapi
    path: "contracts/cognition-observation.yaml#/paths/~1process/post"
observability:
  logs:
    - "cognition.observation.llm_request"
    - "cognition.observation.fallback"
    - "minecraft.observation.forwarded"
  metrics:
    - "cognition_observation_llm_latency_ms"
    - "cognition_observation_fallback_total"
    - "minecraft_observation_tasks_created"
  traces:
    - "observation.reasoning.pipeline"
migrations: []
rollback:
  - "Set COGNITION_LLM_OBSERVATION_DISABLED=true to bypass LLM reasoning and revert to deterministic strings"
  - "Feature flag minecraft interface to skip structured observation payloads via USE_LEGACY_ENTITY_THOUGHTS=true"
