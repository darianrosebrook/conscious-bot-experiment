id: COG-LOG-1001
title: "Unify cognition server logging with structured server logger"
risk_tier: 3
scope:
  in:
    - "Replace ad-hoc console logs in cognition server with structured server logger"
    - "Remove emoji prefixes; use tags/subsystem fields or colorized logger output"
    - "Add coherent middleware request logging (consistent fields)"
  out:
    - "Changes to logging in other packages outside cognition server"
    - "Behavioral changes to business logic"
    - "New external logging dependencies"
invariants:
  - "No change to API responses, status codes, or routes"
  - "No change to thought generation behavior or timing"
  - "Logging remains non-blocking and does not throw"
acceptance:
  - id: A1
    given: "server is running"
    when: "startup, shutdown, and recurring tasks occur"
    then: "logs are emitted with consistent fields and no emoji prefixes"
  - id: A2
    given: "middleware receives requests"
    when: "response finishes"
    then: "a structured log entry is emitted with operation type and success flag"
  - id: A3
    given: "an error occurs in thought generation or external health check"
    when: "error is caught"
    then: "error is logged with subsystem and reason fields"
non_functional:
  a11y: []
  perf:
    api_p95_ms: 250
  security:
    - "No sensitive data logged (PII redaction preserved)"
contracts:
  - type: openapi
    path: "contracts/none"
observability:
  logs:
    - "startup/shutdown events (subsystem: cognition-server)"
    - "thought_generation cycle logs (subsystem: thought-gen)"
    - "request lifecycle logs (subsystem: middleware)"
  metrics: []
  traces: []
migrations: []
rollback:
  - "Revert logging changes in cognition server"
