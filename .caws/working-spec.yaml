id: STIR-510
title: "Golden Run Proof for Sterling IR Pipeline"
risk_tier: 2
scope:
  in:
    - "Dev-gated sterling_ir injection endpoint for sink proof"
    - "Golden run recorder emitting artifacts from planning runtime"
    - "Idle episode -> Sterling reduction -> sterling_ir task path"
    - "Report linkage across reduction/expansion/dispatch/verification"
  out:
    - "UI changes or dashboard modifications"
    - "Any TS-side semantic parsing or goal inference"
    - "Sterling semantic policy changes"
invariants:
  - "No semantic authority creep: TS does not parse text or infer requirements"
  - "Injected tasks flow through TaskIntegration.addTask() and materializeSterlingIrSteps()"
  - "Golden run reporting is observational only; no behavior changes"
  - "sterling_ir tasks bypass resolveRequirement() and similarity dedupe"
  - "Idle episodes create tasks only when Sterling returns executable reduction"
acceptance:
  - id: A1
    given: "dev injection request with committed_ir_digest + schema_version"
    when: "planning injects sterling_ir task"
    then: "task is created via TaskIntegration and expansion is attempted once"
  - id: A2
    given: "expansion returns ok with steps"
    when: "task is created"
    then: "task becomes pending with attached steps and expansion metadata recorded"
  - id: A3
    given: "executor dispatches a leaf step"
    when: "verification completes"
    then: "golden run report captures dispatch + verification evidence"
  - id: A4
    given: "idle conditions met and idle episodes enabled"
    when: "Sterling returns executable reduction"
    then: "a sterling_ir task is created from reduction without TS semantics"
  - id: A5
    given: "a golden run"
    when: "run completes"
    then: "artifacts/golden-run/golden-<run_id>.json exists with task, expansion, dispatch, verification"
non_functional:
  perf:
    api_p95_ms: 2000
  security:
    - "Dev injection endpoint gated by ENABLE_DEV_ENDPOINTS=true"
contracts:
  - type: openapi
    path: "contracts/sterling-executor.yaml#/paths/~1sterling~1expand-by-digest/post"
observability:
  logs:
    - "[GoldenRun] injection"
    - "[GoldenRun] expansion"
    - "[GoldenRun] dispatch"
    - "[GoldenRun] verification"
  metrics: []
  traces: []
rollback:
  - "Disable ENABLE_DEV_ENDPOINTS or remove golden run recording"
  - "Disable STERLING_IDLE_EPISODES_ENABLED"
